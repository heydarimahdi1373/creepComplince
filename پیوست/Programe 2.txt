clc;
clear all;
close all;
aaa=0;   
e=2.818281828;
rand1=rand(1,18);
rand2=rand(1,18);
A1=[-0.001	-0.001	-10	-10	-100	-100	-1500	-1500	-12000	-12000	-100000	-100000	-10000000000	-10000000000	-1E+15	-1E+15	-1E+20	-1E+20];
A2=[0.1	-0.1	1000	-1000	10000	-10000	150000	-150000	1200000	-1200000	10000000	-10000000	1E+12	-10000000000	1E+17	-1E+17	1E+22	-1E+22];
A=A1+A2*i;
w=[1.06E-08	1.12E-07	1.04E-06	1.10E-05	0.000116232	0.000307211	0.00107189	0.00325509	0.00988496	0.0300184	0.104737	0.318063	9.66E-01	3.37E+00	1.02E+01	3.11E+01	9.44E+01	1.00E+03	1.06E+04	97712.4	1.04E+06	1.10E+07	1.01E+08	1.07E+09	1.14E+10	1.05E+11	1.11E+12	1.18E+13	1.08E+14	1.15E+15	1.06E+16	1.12E+17	1.04E+18	1.10E+19	1.16E+20	1.07E+21	9.88E+21];
E1=[44.8716	46.0932	45.9845	47.2364	52.9917	63.1378	97.9579	186.698	325.816	639.481	935.55	1451.71	1888.7	2249.66	2759.88	3192.67	3381.82	4023.39	4513.6	5064.28	5202.15	5503.05	5822.21	5807.62	5965.74	6129.06	6483.57	6280.14	6644.37	6435.9	6809.17	6792.11	6776.09	7168.02	7150.06	7345.8	7546.91];
E2=[1.06E-08	1.12E-07	1.04E-06	1.10E-05	0.000116232	0.000307211	0.00107189	0.00325509	0.00988496	0.0344896	0.104737	0.318063	1.10975	3.37006	10.2341	31.0787	108.437	1000	10595.6	112267	1.04E+06	1.10E+07	1.01E+08	1.07E+09	1.14E+10	1.05E+11	1.11E+12	1.18E+13	1.08E+14	1.15E+15	1.06E+16	9.77E+16	1.04E+18	1.10E+19	1.16E+20	1.07E+21	1.14E+22];
E=E1+E2*i;
X=zeros(37,37);
AA=A;
for q=1:5
    for j=1:37
    ww=w(j);
        for k=1:18
            X(k,j)=1/(i*ww-AA(k));
            X(k+19,j)=-E(j)/(i*ww-AA(k));
        end
        X(19,j)=1;
    end
    
    B=zeros(37,1);
    F=zeros(37,37);
    for a=1:37
        for b=1:37
            for c=1:37
                F(a,b)=F(a,b)+X(a,c)*X(b,c);
            end
            B(a)=B(a)+X(a,b)*E(b);
        end
    end
    r=pinv(F)*B;
    
    syms x;
    P=r(20)/(x-AA(1));
    for o=2:18
        P=P+r(o+19)/(x-AA(o));
    end
    P=P+1;
    z=double(solve(P,x));
    
    AA=eig(diag(AA)-ones(18,1)*z');
end

for j=1:37
    ww=w(j);
    for k=1:18
        X(k,j)=1/(i*ww-AA(k));
        X(k+19,j)=-E(j)/(i*ww-AA(k));
    end
    X(19,j)=1;
end
    
B=zeros(37,1);
F=zeros(37,37);
for a=1:37
    for b=1:37
       for c=1:37
           F(a,b)=F(a,b)+X(a,c)*X(b,c);
       end
       B(a)=B(a)+X(a,b)*E(b);
    end
end
r=pinv(F)*B;

t=[5.954,7.35211,9.07852,11.2103,14.5922,18.5002,25.3852,36.7185,44.1609,63.8769,89.9909,133.645,165.028,287.088,383.68,569.804,685.295,824.196,1224.01];
m=zeros(1,19);
for i=1:19
    for j=1:18
        m(i)=m(i)+r(j)*e^(AA(j)*t(j));
    end
    m(i)=m(i)+r(19);
end
semilogx(t,m)